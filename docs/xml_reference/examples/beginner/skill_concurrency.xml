<?xml version="1.0" encoding="UTF-8"?>

<!-- This example application shows the usage of a skill hierarchy.

With a low priority, the robot tracks target1 ("my_tracker"). With a high
priority, the robot sequencially moves up and down along the z axis
("my_hierarchy"). After six seconds, the application terminates.
-->

<pitasc>

    <models>
        <include package="pitasc_library" file="models/pitasc.xml"/>
        <include package="pitasc_library" file="models/skills.xml"/>

        <include package="pitasc_library" file="universal_robots/ur.xml"/>
    </models>

    <clone prototype="project">

        <member id="configuration">
            <clone id="configuration" prototype="default_configuration"/>
        </member>

        <member id="environment">
            <clone prototype="robot_ur5">
                <member id="robot_driver.max_velocity">2.0</member>
                <member id="robot_driver.max_acceleration">3.0</member>
            </clone>
        </member>

        <member id="applications">
            <clone id="my_application" prototype="skill_sequence">

                <!-- Use this robot for this skill and all its subskills -->
                <member id="robot" reference_id="environment.robot_ur5"/>

                <!-- Add skills -->
                <member id="skills">

                    <!-- First move to start position -->
                    <clone prototype="skill_lin">
                        <member id="tool_frame">tool</member>
                        <member id="target_frame">target1</member>
                    </clone>


                    <!-- Hierarchy: Move down (-z) and to target1 -->
                    <clone prototype="skill_concurrency">
                        <member id="skill_name">my_hierarchy</member>
                        <member id="skills">

                            <clone prototype="skill_sequence">
                                <member id="skills">

                                    <!-- Move along axis (high priority) -->
                                    <clone prototype="skill_cartesian_velocity">
                                        <member id="skill_name">move_down</member>
                                        <member id="tool_frame">tool</member>
                                        <member id="velocity_frame">target1</member>
                                        <member id="axes">z</member>
                                        <member id="velocities">-0.02</member>
                                        <member id="monitors">
                                            <clone prototype="monitor_duration">
                                                <member id="duration">2.0</member>
                                            </clone>
                                        </member>
                                    </clone>

                                    <!-- Move along axis (high priority) -->
                                    <clone prototype="skill_cartesian_velocity">
                                        <member id="skill_name">move_up</member>
                                        <member id="velocity_frame">target1</member>
                                        <member id="tool_frame">tool</member>
                                        <member id="axes">z</member>
                                        <member id="velocities">0.02</member>
                                        <member id="monitors">
                                            <clone prototype="monitor_duration">
                                                <member id="duration">2.0</member>
                                            </clone>
                                        </member>
                                    </clone>

                                    <!-- Move along axis (high priority) -->
                                    <clone prototype="skill_cartesian_velocity">
                                        <member id="skill_name">move_down_again</member>
                                        <member id="velocity_frame">target1</member>
                                        <member id="tool_frame">tool</member>
                                        <member id="axes">z</member>
                                        <member id="velocities">-0.02</member>
                                        <member id="monitors">
                                            <clone prototype="monitor_duration">
                                                <member id="duration">2.0</member>
                                            </clone>
                                        </member>
                                    </clone>
                                </member>
                            </clone>

                            <!-- Track frame (low priority) to constrain remaining axes -->
                            <clone prototype="skill_cartesian_tracking">
                                <member id="skill_name">my_tracker</member>
                                <member id="tool_frame">tool</member>
                                <member id="target_frame">target1</member>
                            </clone>

                        </member>

                        <!-- Quit after 6 seconds -->
                        <member id="monitors">
                            <clone prototype="monitor_duration">
                                <member id="duration">6.0</member>
                            </clone>
                        </member>

                    </clone>


                </member>

            </clone>
        </member>

    </clone>

</pitasc>
