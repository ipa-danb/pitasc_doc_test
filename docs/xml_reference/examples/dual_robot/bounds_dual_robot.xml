<?xml version="1.0" encoding="UTF-8"?>

<!-- This example application shows the usage of 2 robots in the same app
(both sequentially and
concurrently).
-->


<pitasc>

    <models>

        <include package="pitasc_library" file="models/pitasc.xml" />
        <include package="pitasc_library" file="models/skills.xml" />

        <include package="pitasc_library" file="universal_robots/ur.xml" />
    </models>


    <!-- Create an application -->
    <clone prototype="project">

        <member id="configuration">
            <clone id="configuration" prototype="default_configuration" />
        </member>

        <member id="environment">
            <clone id="ur5" prototype="robot_ur5">
                <member id="namespace">ur5</member>
                <member id="robot_driver.max_velocity">1.0</member>
                <member id="robot_driver.max_acceleration">2.0</member>
                <member id="robot_driver.send_velocities_if_inactive">True</member>  <!-- set to true
                to keep sending zero velocities if the robot is not used in a skill -->
                <member id="urdf_prefix">ur5_</member>
            </clone>
            <clone id="ur3" prototype="robot_ur3">
                <member id="namespace">ur3</member>
                <member id="robot_driver">
                    <member id="max_velocity">1.0</member>
                    <member id="max_acceleration">2.0</member>
                    <member id="send_velocities_if_inactive">True</member>  <!-- set to true to keep
                    sending zero velocities if the robot is not used in a skill -->
                </member>
                <member id="urdf_prefix">ur3_</member>
            </clone>
        </member>


        <member id="applications">
            <clone prototype="skill_sequence">
                <member id="robot" reference_id="environment.ur3" />

                <member id="skills">
                    <!-- move both robots sequentially -->
                    <clone prototype="skill_sequence">
                        <member id="robot" reference_id="environment.ur3" />
                        <member id="skills">
                            <!-- Move ur3 to target 1 -->
                            <clone prototype="skill_concurrency">
                                <member id="skills">
                                    <clone prototype="skill_lin">
                                        <member id="tool_frame">ur3_tool0</member>
                                        <member id="target_frame">target1</member>
                                        <member id="target_offsets">0.0,0,0,0,0,0</member>
                                    </clone>
                                    <clone prototype="skill_cartesian_bound">
                                        <member id="tool_frame">ur3_tool0</member>
                                        <member id="target_frame">target1</member>
                                        <member id="axes">x</member>
                                        <member id="lower_bound">0.01</member>
                                        <member id="upper_bound">0.5</member>
                                        <member id="scaler">1.0</member>
                                    </clone>
                                </member>
                                <member id="monitors">
                                    <clone prototype="monitor_duration">
                                        <member id="duration">5.0</member>
                                    </clone>
                                </member>
                            </clone>

                            <!-- Move ur5 to target 1 -->
                            <clone prototype="skill_lin">
                                <member id="robot" reference_id="environment.ur5" />
                                <member id="tool_frame">ur5_tool</member>
                                <member id="target_frame">target1</member>
                                <member id="target_offsets">-0.1,0,0,0,0,0</member>
                            </clone>

                            <!-- Move ur3 to target 2 -->
                            <clone prototype="skill_lin">
                                <member id="tool_frame">ur3_tool0</member>
                                <member id="target_frame">target2</member>
                                <member id="target_offsets">0.1,0,0,0,0,0</member>
                            </clone>

                            <!-- Move ur5 to target 2 -->
                            <clone prototype="skill_lin">
                                <member id="robot" reference_id="environment.ur5" />
                                <member id="tool_frame">ur5_tool</member>
                                <member id="target_frame">target2</member>
                                <member id="target_offsets">-0.1,0,0,0,0,0</member>
                            </clone>
                        </member>
                    </clone>

                    <!-- move both robots concurrently -->
                    <clone prototype="skill_parallel">
                        <member id="robot" reference_id="environment.ur3" />
                        <member id="skills">
                            <!-- Move ur3 to target 1 -->
                            <clone prototype="skill_concurrency">
                                <member id="skills">
                                    <clone prototype="skill_lin">
                                        <member id="tool_frame">ur3_tool0</member>
                                        <member id="target_frame">target1</member>
                                        <member id="target_offsets">0.1,0,0,0,0,0</member>
                                    </clone>
                                    <clone prototype="skill_cartesian_bound">
                                        <member id="tool_frame">ur3_tool0</member>
                                        <member id="target_frame">target1</member>
                                        <member id="axes">x</member>
                                        <member id="lower_bound">0.01</member>
                                        <member id="upper_bound">0.5</member>
                                        <member id="scaler">1.0</member>
                                    </clone>
                                </member>
                            </clone>

                            <!-- Move ur5 to target 1 -->
                            <clone prototype="skill_concurrency">
                                <member id="skills">
                                    <clone prototype="skill_lin">
                                        <member id="robot" reference_id="environment.ur5" />
                                        <member id="tool_frame">ur5_tool</member>
                                        <member id="target_frame">target1</member>
                                        <member id="target_offsets">0,0,0,0,0,0</member>
                                    </clone>
                                    <clone prototype="skill_cartesian_bound">
                                        <member id="robot" reference_id="environment.ur5" />
                                        <member id="tool_frame">ur5_tool</member>
                                        <member id="target_frame">target1</member>
                                        <member id="axes">z</member>
                                        <member id="lower_bound">0.1</member>
                                        <member id="upper_bound">0.5</member>
                                        <member id="scaler">1.0</member>
                                    </clone>
                                </member>
                                <member id="monitors">
                                    <clone prototype="monitor_duration">
                                        <member id="duration">5.0</member>
                                    </clone>
                                </member>
                            </clone>

                        </member>
                    </clone>

                </member>

            </clone>
        </member>

    </clone>

</pitasc>