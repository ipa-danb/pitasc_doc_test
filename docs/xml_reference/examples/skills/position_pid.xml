<?xml version="1.0" encoding="UTF-8"?>

<!-- This example application shows the usage of some force skills.
Move to a target, establishes a contact, pushes for some seconds,
keeps on pushing while moving in another direction (slide), returns to the initial target
-->

<pitasc>

    <models>
        <include package="pitasc_library" file="models/pitasc.xml" />
        <include package="pitasc_library" file="models/skills.xml" />

        <include package="pitasc_library" file="universal_robots/ur.xml" />
    </models>

    <clone prototype="project">

        <member id="configuration">
            <clone id="configuration" prototype="default_configuration" />
        </member>

        <member id="environment">
            <clone prototype="robot_ur5">
                <member id="robot_driver.max_velocity">2.0</member>
                <member id="robot_driver.max_acceleration">3.0</member>
                <member id="components">
                    <clone prototype="force_sensor">
                        <member id="wrench_topic">wrench</member>
                    </clone>
                </member>
            </clone>
        </member>

        <member id="applications">
            <clone prototype="skill_sequence">

                <member id="robot" reference_id="environment.robot_ur5" />

                <!-- Skills -->
                <member id="skills">

                    <!-- First move to start position -->
                    <clone prototype="skill_relative_ptp">
                        <member id="relative_joint_state">0, 0, 0, -0.01, 0, 0</member>
                    </clone>

                    <clone prototype="skill_lin">
                        <member id="tool_frame">tool</member>
                        <member id="target_frame">start_position</member>
                    </clone>

                    <clone prototype="skill_cartesian_tracking_pid">
                        <member id="tool_frame">tool</member>
                        <member id="target_frame">start_position</member>
                        <member id="target_offsets">0,0,-0.05, 0,0,0</member>
                        <member id="K">0.3</member>
                        <member id="Tv">0.01</member>
                        <member id="Tn">0.51</member>
                        <member id="Tp">0.001</member>
                        <member id="u_i_limit">0.01</member>

                        <member id="I_flag">false</member>
                        <member id="D_flag">false</member>

                        <!-- Quit after 5 seconds -->
                        <member id="monitors">
                            <clone prototype="monitor_duration">
                                <member id="duration">5.0</member>
                            </clone>
                        </member>

                        <member id="scripts">
                            <!-- publish measurements to a ros topic-->
                            <clone prototype="script_measurement_publisher">
                                <member id="provider"
                                    reference_id="collections.target_to_tool.chains[0]" />
                                <member id="topic">tool_position</member>
                                <member id="coordinates">x,y,z</member>
                            </clone>
                        </member>

                    </clone>


                    <!-- Back to start position -->
                    <clone id="back" prototype="skill_lin">
                        <member id="tool_frame">tool</member>
                        <member id="target_frame">start_position</member>
                    </clone>

                    <clone prototype="skill_cartesian_tracking_pid">
                        <member id="tool_frame">tool</member>
                        <member id="target_frame">start_position</member>
                        <member id="target_offsets">0,0,-0.05, 0,0,0</member>
                        <member id="K">0.3</member>
                        <member id="Tv">0.5</member>
                        <member id="Tn">0.5</member>
                        <member id="Tp">0.05</member>
                        <member id="u_i_limit">0.01</member>

                        <member id="I_flag">false</member>
                        <member id="D_flag">true</member>

                        <!-- Quit after 5 seconds -->
                        <member id="monitors">
                            <clone prototype="monitor_duration">
                                <member id="duration">5.0</member>
                            </clone>
                        </member>

                        <member id="scripts">
                            <!-- publish measurements to a ros topic-->
                            <clone prototype="script_measurement_publisher">
                                <member id="provider"
                                    reference_id="collections.target_to_tool.chains[0]" />
                                <member id="topic">tool_position</member>
                                <member id="coordinates">x,y,z</member>
                            </clone>
                        </member>

                    </clone>


                    <!-- Back to start position -->
                    <clone id="back" prototype="skill_lin">
                        <member id="tool_frame">tool</member>
                        <member id="target_frame">start_position</member>
                    </clone>

                    <clone prototype="skill_cartesian_tracking_pid">
                        <member id="tool_frame">tool</member>
                        <member id="target_frame">start_position</member>
                        <member id="target_offsets">0,0,-0.05, 0,0,0</member>
                        <member id="K">0.18</member>
                        <member id="Tv">0.01</member>
                        <member id="Tn">100.0</member>
                        <member id="Tp">0.001</member>
                        <member id="u_i_limit">0.01</member>

                        <member id="I_flag">true</member>
                        <member id="D_flag">false</member>

                        <!-- Quit after 5 seconds -->
                        <member id="monitors">
                            <clone prototype="monitor_duration">
                                <member id="duration">5.0</member>
                            </clone>
                        </member>

                        <member id="scripts">
                            <!-- publish measurements to a ros topic-->
                            <clone prototype="script_measurement_publisher">
                                <member id="provider"
                                    reference_id="collections.target_to_tool.chains[0]" />
                                <member id="topic">tool_position</member>
                                <member id="coordinates">x,y,z</member>
                            </clone>
                        </member>

                    </clone>


                    <!-- Back to start position -->
                    <clone id="back" prototype="skill_lin">
                        <member id="tool_frame">tool</member>
                        <member id="target_frame">start_position</member>
                    </clone>


                    <clone prototype="skill_cartesian_tracking_pid">
                        <member id="tool_frame">tool</member>
                        <member id="target_frame">start_position</member>
                        <member id="target_offsets">0,0,-0.05, 0,0,0</member>
                        <member id="K">0.3</member>
                        <member id="Tv">0.01</member>
                        <member id="Tn">0.5</member>
                        <member id="Tp">0.001</member>
                        <member id="u_i_limit">0.01</member>

                        <member id="I_flag">true</member>
                        <member id="D_flag">true</member>

                        <!-- Quit after 5 seconds -->
                        <member id="monitors">
                            <clone prototype="monitor_duration">
                                <member id="duration">5.0</member>
                            </clone>
                        </member>

                        <member id="scripts">
                            <!-- publish measurements to a ros topic-->
                            <clone prototype="script_measurement_publisher">
                                <member id="provider"
                                    reference_id="collections.target_to_tool.chains[0]" />
                                <member id="topic">tool_position</member>
                                <member id="coordinates">x,y,z</member>
                            </clone>
                        </member>

                    </clone>


                    <!-- Back to start position -->
                    <clone id="back" prototype="skill_lin">
                        <member id="tool_frame">tool</member>
                        <member id="target_frame">start_position</member>
                    </clone>

                </member>

            </clone>
        </member>

    </clone>

</pitasc>