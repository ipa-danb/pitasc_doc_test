<?xml version="1.0" encoding="UTF-8"?>

<!-- This example application shows the usage of spherical skills
-->

<pitasc>

    <models>
        <include package="pitasc_library" file="models/pitasc.xml"/>
        <include package="pitasc_library" file="models/skills.xml"/>

        <include package="pitasc_library" file="universal_robots/ur.xml"/>
    </models>

    <clone prototype="project">

        <member id="configuration">
            <clone id="configuration" prototype="default_configuration"/>
        </member>

        <member id="environment">
            <clone prototype="robot_ur5">
                <member id="robot_driver.max_velocity">2.0</member>
                <member id="robot_driver.max_acceleration">3.0</member>
                <member id="components">
                    <clone prototype="force_sensor">
                        <member id="wrench_topic">wrench</member>
                    </clone>
                </member>
            </clone>
      </member>

        <member id="applications">
            <clone prototype="skill_sequence">

                <!-- Use this robot for this skill and all its subskills -->
                <member id="robot" reference_id="environment.robot_ur5"/>

                <!-- Add skills -->
                <member id="skills">

                  <!-- move to start position -->
                  <clone prototype="skill_spherical_positioning">
                      <member id="tool_frame">tool</member>
                      <member id="target_frame">start_position</member>
                      <member id="target_offsets">0, 2.7, 0.1, -3.14, 0, 0</member>
                      <!-- phi, theta, r, a, b, c -->
                  </clone>

                    <clone prototype="skill_concurrency">
                        <member id="skills">
                            <clone prototype="skill_spherical_velocity">
                                <member id="target_frame">start_position</member>
                                <member id="tool_frame">tool</member>
                                <member id="axes">phi</member>
                                <member id="velocities">0.5</member>
                                <member id="monitors">
                                    <clone id="phi_threshold" prototype="monitor_threshold">
                                        <member id="provider" reference_id="hold.collections.target_to_tool.chains[0]"/>
                                        <member id="coordinates">phi</member>
                                        <member id="prefix" reference_id="hold.collections.target_to_tool.prefix"/>
                                        <member id="operator">absolute_greater</member>
                                        <member id="thresholds">3.0</member>  <!-- phi is periodic and jumps from pi to -pi (in some cases it might jump from +3.13 to -3.13) -->
                                    </clone>
                                </member>
                            </clone>
                            <clone id="hold" prototype="skill_spherical_tracking">
                                <member id="tool_frame">tool</member>
                                <member id="target_frame">start_position</member>
                                <member id="axes">theta, r, a, b, c</member>
                                <member id="target_offsets">2.7, 0.1, -3.14, 0, 0</member>
                            </clone>
                        </member>
                    </clone>

                </member>

            </clone>
        </member>

    </clone>

</pitasc>
