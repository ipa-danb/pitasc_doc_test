<?xml version="1.0" encoding="UTF-8"?>

<pitasc>

    <models>
        <include package="pitasc_library" file="models/pitasc.xml"/>

        <type id="skill_force" prototype="skill_single_robot">
            <meta>
                <member id="description">Models a loop for force control</member>
                <member id="categories">single_robot, force_controlled</member>
                <member id="visibility">expert</member>
            </meta>

            <data>
                <!-- Kinematics -->
                <type id="force_frame" prototype="string_parameter">
                    <meta>
                        <member id="description">Frame describing the force coordinates</member>
                        <member id="visibility">required</member>
                    </meta>
                </type>

                <reference id="force_sensor" prototype="dictionary" reference_id="robot.components.force_sensor"/>
                <member id="force_sensor.meta.description">Force sensor that provides the wrench measurement.</member>
                <member id="force_sensor.meta.visibility">expert</member>

                <!-- Implementation details below: -->

                <member id="collections">
                    <clone id="force_chain" prototype="force_relationship">
                        <member id="chain_name">force_chain</member>
                        <member id="wrench_driver" reference_id="force_sensor.wrench_driver"/>
                        <member id="force_frame" reference_id="force_frame"/>
                    </clone>
                    <clone id="object_chains" prototype="collection">
                        <member id="chains">
                            <clone id="base_to_force_frame" prototype="observed_chain">
                                <member id="chain_name">base_to_force_frame</member>
                                <member id="control">False</member>
                                <member id="from_frame" reference_id="robot.base_link"/>
                                <member id="to_frame" reference_id="force_frame"/>
                            </clone>
                            <clone id="eef_to_force_frame" prototype="observed_chain">
                                <member id="chain_name">eef_to_force_frame</member>
                                <member id="control">False</member>
                                <member id="from_frame" reference_id="robot.ee_link"/>
                                <member id="to_frame" reference_id="force_frame"/>
                            </clone>
                        </member>
                    </clone>
                </member>
                <member id="collections.meta.visibility">hidden</member>

                <member id="loops">
                    <clone prototype="kinematic_loop">
                        <member id="loop_name">viaForce</member>
                        <member id="robot_chains">
                            <reference prototype="kinematic_chain_base" reference_id="robot.chains[0]"/>
                            <reference prototype="kinematic_chain_base" reference_id="collections.object_chains.chains.eef_to_force_frame"/>
                        </member>
                        <member id="feature_chains">
                            <reference prototype="kinematic_chain_base" reference_id="collections.object_chains.chains.base_to_force_frame"/>
                            <reference prototype="kinematic_chain_base" reference_id="collections.force_chain.chains[0]"/>
                        </member>
                    </clone>
                </member>
                <member id="loops.meta.visibility">hidden</member>

            </data>
        </type>

    </models>

</pitasc>
