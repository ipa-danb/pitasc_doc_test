<?xml version="1.0" encoding="UTF-8"?>

<pitasc>

    <models>
        <include package="pitasc_library" file="skills/skill_cartesian_velocity.xml"/>
        <include package="pitasc_library" file="skills/skill_hold_pose.xml"/>
        <include package="pitasc_library" file="skills/skill_force.xml"/>

        <type id="skill_guarded_approach" prototype="skill_concurrency">
            <meta>
                <member id="description">A skill that moves along a fixed frame axis until it measures a certain force</member>
                <member id="categories">single_robot, force_controlled</member>
            </meta>

            <data>

                <type id="max_forces" prototype="float_csv">
                    <meta>
                        <member id="description">Forces in [N].</member>
                        <member id="visibility">basic</member>
                    </meta>
                    <data>10.0</data>
                </type>

                <type id="tool_frame" prototype="frame">
                    <meta>
                        <member id="description">Name of the tool frame.</member>
                        <member id="visibility">required</member>
                    </meta>
                </type>

                <type id="control_frame" prototype="frame">
                    <meta>
                        <member id="description">Name of the frame that defines the direction of motion.</member>
                        <member id="visibility">required</member>
                    </meta>
                </type>

                <type id="axes" prototype="string_csv">
                    <meta>
                        <member id="description">The direction of motion. Can be multiple axes.</member>
                        <member id="visibility">basic</member>
                        <clone prototype="restrictions">
                            <clone prototype="enum">x, y, z</clone>
                        </clone>
                    </meta>
                    <data>x</data>
                </type>

                <type id="velocities" prototype="float_csv">
                    <meta>
                        <member id="description">Velocities in [m/s].</member>
                        <member id="visibility">basic</member>
                    </meta>
                    <data>0.01</data>
                </type>

                <!-- Implementation details below: -->

                <clone id="move_skill" prototype="skill_cartesian_velocity">
                    <member id="velocity_frame" reference_id="control_frame"/>
                    <member id="tool_frame" reference_id="tool_frame"/>
                    <member id="axes" reference_id="axes"/>
                    <member id="velocities" reference_id="velocities"/>
                </clone>
                <member id="move_skill.meta.visibility">expert</member>

                <clone id="hold_skill" prototype="skill_hold_pose">
                    <member id="tool_frame" reference_id="tool_frame"/>
                </clone>
                <member id="hold_skill.meta.visibility">expert</member>

                <clone id="force_skill" prototype="skill_force">
                    <member id="force_frame" reference_id="control_frame"/>
                </clone>
                <member id="force_skill.meta.visibility">expert</member>

                <member id="monitors">
                    <clone id="force_threshold" prototype="monitor_threshold">
                        <member id="provider" reference_id="force_skill.collections.force_chain.chains[0]"/>
                        <member id="coordinates" reference_id="axes"/>
                        <member id="prefix" reference_id="force_skill.collections.force_chain.prefix"/>
                        <member id="operator">absolute_greater</member>
                        <member id="thresholds" reference_id="max_forces"/>
                    </clone>
                </member>

                <member id="skills">
                    <reference reference_id="move_skill"/>
                    <reference reference_id="hold_skill"/>
                    <reference reference_id="force_skill"/>
                </member>
                <member id="skills.meta.visibility">expert</member>

            </data>
        </type>

    </models>

</pitasc>
