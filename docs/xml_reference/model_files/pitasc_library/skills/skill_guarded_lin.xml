<?xml version="1.0" encoding="UTF-8"?>

<pitasc>

    <models>
        <include package="pitasc_library" file="skills/skill_lin.xml"/>
        <include package="pitasc_library" file="skills/skill_force.xml"/>

        <type id="skill_guarded_lin" prototype="skill_concurrency">
            <meta>
                <member id="description">Causes a linear motion until a specified force value is reached</member>
                <member id="categories">single_robot, force_controlled</member>
            </meta>

            <data>

                <type id="tool_frame" prototype="frame">
                    <meta>
                        <member id="description">Name of the tool frame.</member>
                        <member id="visibility">required</member>
                    </meta>
                </type>

                <type id="target_frame" prototype="frame">
                    <meta>
                        <member id="description">Name of the target frame.</member>
                        <member id="visibility">required</member>
                    </meta>
                </type>

                <type id="axes" prototype="string_csv">
                    <meta>
                        <member id="description">List of axes to be aligned.</member>
                        <member id="visibility">basic</member>
                        <clone prototype="restrictions">
                            <clone prototype="enum">x, y, z, a, b, c</clone>
                        </clone>
                    </meta>
                    <data>x, y, z, a, b, c</data>
                </type>

                <type id="target_offsets" prototype="float_csv">
                    <meta>
                        <member id="description">Offsets of the axes to be aligned. Must be the same number of values as for 'axes'.</member>
                        <member id="visibility">basic</member>
                        <clone prototype="restrictions">
                            <clone prototype="float_csv_min">-10.0, -10.0, -10.0, -3.14, -3.14, -3.14</clone>
                            <clone prototype="float_csv_max">10.0, 10.0, 10.0, 3.14, 3.14, 3.14</clone>
                        </clone>
                    </meta>
                    <data>0, 0, 0, 0, 0, 0</data>
                </type>

                <type id="max_linear_velocity" prototype="float_parameter">
                    <meta>
                        <member id="description">
                            Max linear velocity.
                        </member>
                        <member id="visibility">basic</member>
                    </meta>
                    <data>1.0</data>
                </type>

                <type id="max_angular_velocity" prototype="float_parameter">
                    <meta>
                        <member id="description">
                            Max angular velocity.
                        </member>
                        <member id="visibility">basic</member>
                    </meta>
                    <data>1.5</data>
                </type>

                <type id="linear_controller_gain" prototype="float_parameter">
                    <meta>
                        <member id="description">
                            Specifies the approx. linear gain of the controller transfer function for Cartesian positions (i.e. x,y and z).
                        </member>
                        <member id="visibility">expert</member>
                    </meta>
                    <data>3</data>
                </type>

                <type id="angular_controller_gain" prototype="float_parameter">
                    <meta>
                        <member id="description">
                            Specifies the approx. linear gain of the controller transfer function for Cartesian angles (i.e. a,b and c).
                        </member>
                        <member id="visibility">expert</member>
                    </meta>
                    <data>3</data>
                </type>

                <type id="max_forces" prototype="float_csv">
                    <meta>
                        <member id="description">Forces in [N].</member>
                        <member id="visibility">basic</member>
                    </meta>
                    <data>10.0</data>
                </type>

                <type id="monitor_axes" prototype="string_csv">
                    <meta>
                        <member id="description">The directions that are monitored for occuring forces (can be multiple axes).</member>
                        <member id="visibility">basic</member>
                        <clone prototype="restrictions">
                            <clone prototype="enum">x, y, z</clone>
                        </clone>
                    </meta>
                    <data>x</data>
                </type>

                <!-- Implementation details below: -->

                <clone id="move_skill" prototype="skill_lin">
                    <member id="tool_frame" reference_id="tool_frame"/>
                    <member id="target_frame" reference_id="target_frame"/>
                    <member id="axes" reference_id="axes"/>
                    <member id="target_offsets" reference_id="target_offsets"/>
                    <member id="max_linear_velocity" reference_id="max_linear_velocity"/>
                    <member id="max_angular_velocity" reference_id="max_angular_velocity"/>
                    <member id="linear_controller_gain" reference_id="linear_controller_gain"/>
                    <member id="angular_controller_gain" reference_id="angular_controller_gain"/>
                </clone>
                <member id="move_skill.meta.visibility">expert</member>

                <clone id="force_skill" prototype="skill_force">
                    <member id="force_frame" reference_id="target_frame"/>
                </clone>
                <member id="force_skill.meta.visibility">expert</member>

                <member id="monitors">
                    <clone id="force_threshold" prototype="monitor_threshold">
                        <member id="provider" reference_id="force_skill.collections.force_chain.chains[0]"/>
                        <member id="coordinates" reference_id="monitor_axes"/>
                        <member id="prefix" reference_id="force_skill.collections.force_chain.prefix"/>
                        <member id="operator">absolute_greater</member>
                        <member id="thresholds" reference_id="max_forces"/>
                    </clone>
                </member>

                <member id="skills">
                    <reference reference_id="move_skill"/>
                    <reference reference_id="force_skill"/>
                </member>
                <member id="skills.meta.visibility">expert</member>

            </data>
        </type>

    </models>

</pitasc>
