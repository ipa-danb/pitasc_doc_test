<?xml version="1.0" encoding="UTF-8"?>

<pitasc>

    <models>
        <include package="pitasc_library" file="models/pitasc.xml"/>
        <include package="pitasc_library" file="skills/skill_hold_pose.xml"/>
        <include package="pitasc_library" file="skills/skill_apply_force.xml"/>

        <type id="skill_push" prototype="skill_concurrency">
            <meta>
                <member id="description">A skill that pushes and keeps the position</member>
                <member id="categories">single_robot, force_controlled</member>
                <member id="visibility">basic</member>
            </meta>

            <data>

                <type id="tool_frame" prototype="frame">
                    <meta>
                        <member id="description">Name of the tool frame.</member>
                        <member id="visibility">required</member>
                    </meta>
                </type>

                <type id="force_frame" prototype="frame">
                    <meta>
                        <member id="description">Name of the frame that defines the direction of motion.</member>
                        <member id="visibility">required</member>
                    </meta>
                </type>

                <type id="axes" prototype="string_csv">
                    <meta>
                        <member id="description">List of axes.</member>
                        <clone prototype="restrictions">
                            <clone prototype="enum">x, y, z, a, b, c</clone>
                        </clone>
                        <member id="visibility">required</member>
                    </meta>
                </type>

                <type id="target_forces" prototype="float_csv">
                    <meta>
                        <member id="description">Forces and torques to be applied. Must be the same number of values as for 'axes'.</member>
                        <clone prototype="restrictions">
                            <clone prototype="float_csv_min">-100.0, -100.0, -100.0, -10.0, -10.0, -10.0</clone>
                            <clone prototype="float_csv_max">100.0, 100.0, 100.0, 10.0, 10.0, 10.0</clone>
                        </clone>
                        <member id="visibility">required</member>
                    </meta>
                </type>

                <type id="compliance" prototype="float_parameter">
                    <meta>
                        <clone prototype="restrictions">
                            <clone prototype="float_min">0.00001</clone>
                            <clone prototype="float_max">0.1</clone>
                        </clone>
                        <member id="visibility">basic</member>
                    </meta>
                    <data>0.002</data>
                </type>

                <type id="corner_frequency" prototype="float_parameter">
                    <meta>
                        <clone prototype="restrictions">
                            <clone prototype="float_min">1.0</clone>
                            <clone prototype="float_max">50.0</clone>
                        </clone>
                        <member id="visibility">basic</member>
                    </meta>
                    <data>5.0</data>
                </type>

                <!-- Implementation details below: -->

                <clone id="force" prototype="skill_apply_force">
                    <member id="force_frame" reference_id="force_frame"/>
                    <member id="axes" reference_id="axes"/>
                    <member id="target_forces" reference_id="target_forces"/>
                    <member id="compliance" reference_id="compliance"/>
                    <member id="corner_frequency" reference_id="corner_frequency"/>
                </clone>
                <member id="force.meta.visibility">expert</member>

                <clone id="hold" prototype="skill_hold_pose">
                    <member id="tool_frame" reference_id="tool_frame"/>
                </clone>
                <member id="hold.meta.visibility">expert</member>

                <member id="skills">
                    <reference reference_id="force"/>
                    <reference reference_id="hold"/>
                </member>
                <member id="skills.meta.visibility">expert</member>

                <member id="collections.meta.visibility">hidden</member>
                <member id="loops.meta.visibility">hidden</member>
                <member id="tasks.meta.visibility">hidden</member>

            </data>
        </type>

        <type id="skill_push_duration" prototype="skill_push">
            <meta>
                <member id="description">A skill that pushes and keeps the position for a certain time.</member>
                <member id="categories">single_robot, force_controlled</member>
            </meta>

            <data>
                <type id="duration" prototype="float_parameter">
                    <meta>
                        <member id="description">Skill duration in [m].</member>
                        <member id="visibility">basic</member>
                    </meta>
                    <data>1.0</data>
                </type>

                <member id="monitors">
                    <clone prototype="monitor_duration">
                        <member id="duration" reference_id="duration"/>
                    </clone>
                </member>
            </data>
        </type>

        <type id="skill_push_settle" prototype="skill_push">
            <meta>
                <member id="description">A skill that pushes until the force error is within a region for an acceptable number of samples.</member>
                <member id="categories">single_robot, force_controlled</member>
            </meta>

            <data>
                <type id="thresholds" prototype="float_csv">
                    <meta>
                        <member id="description">Half the error band peak-to-peak span for successful settling.</member>
                        <member id="visibility">basic</member>
                    </meta>
                    <data>1.0</data>
                </type>
                <type id="samples" prototype="int_parameter">
                    <meta>
                        <member id="description">Number of control steps the measurements need to stay in the error band.</member>
                        <member id="visibility">basic</member>
                    </meta>
                    <data>25</data>
                </type>

                <member id="monitors">
                    <clone prototype="monitor_control_error">
                        <member id="controllers" reference_id="force.tasks.apply_force.controllers"/>
                        <member id="coordinates" reference_id="force.axes"/>
                        <member id="prefix" reference_id="force.collections.force_chain.prefix"/>
                        <member id="thresholds" reference_id="thresholds"/>
                        <member id="samples" reference_id="samples"/>
                    </clone>
                </member>
            </data>
        </type>

    </models>

</pitasc>
